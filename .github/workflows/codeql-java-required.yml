name: CodeQL for Java

on:
  pull_request:
  workflow_dispatch:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  codeql:
    name: Analyze Java
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v4
        - name: CodeQL init
          run: |
            gh extensions install github/gh-codeql
            gh codeql set-version latest
            gh codeql database create ./codeql-db \
              --language=java \
              --overwrite
        - name: CodeQL analyze
          run: |
            gh codeql database analyze ./codeql-db \
              --format=sarif-latest \
              --output=codeql-results.sarif
        - name: CodeQL results upload
          run: |
            gh codeql github upload-results \
              --sarif=codeql-results.sarif \
              --repository=${{ github.repository }} \
              --ref=${{ github.ref }} \
              --commit=${{ github.sha }}'
